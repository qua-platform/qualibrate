
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="QM. Technologies Ltd.">
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../calibration_library/">
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Calibration Nodes - QUAlibrate Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="qualibrate-bright" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calibration-nodes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="QUAlibrate Documentation" class="md-header__button md-logo" aria-label="QUAlibrate Documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            QUAlibrate Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Calibration Nodes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="qualibrate-bright" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to high contrast mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to high contrast mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="qualibrate-high-contrast" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18V6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="qualibrate-dark" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="QUAlibrate Documentation" class="md-nav__button md-logo" aria-label="QUAlibrate Documentation" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    QUAlibrate Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Calibration Nodes
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Calibration Nodes
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-script" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Script
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversion-into-a-qualibrationnode" class="md-nav__link">
    <span class="md-ellipsis">
      Conversion into a QualibrationNode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conversion into a QualibrationNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#importing-qualibrate" class="md-nav__link">
    <span class="md-ellipsis">
      Importing qualibrate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-input-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Defining Input Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-the-qualibrationnode" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the QualibrationNode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-node-parameters-in-the-script" class="md-nav__link">
    <span class="md-ellipsis">
      Using Node Parameters in the Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-results" class="md-nav__link">
    <span class="md-ellipsis">
      Registering Results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saving-results" class="md-nav__link">
    <span class="md-ellipsis">
      Saving Results
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fully-converted-node" class="md-nav__link">
    <span class="md-ellipsis">
      Fully Converted Node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combining-quam-with-qualibrate" class="md-nav__link">
    <span class="md-ellipsis">
      Combining QUAM with QUAlibrate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structuring-nodes-with-actions-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Structuring Nodes with Actions (Optional)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration Library
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../calibration_graphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Calibration Graphs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../web_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web App
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration File
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Additional features
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Additional features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../node_actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node Actions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="calibration-nodes">Calibration Nodes</h1>
<h2 id="introduction">Introduction</h2>
<p>Calibration nodes in QUAlibrate encapsulate calibration routines into reusable components that can run independently or as part of larger workflows. This guide demonstrates how to transform an existing calibration script into a <code>QualibrationNode</code> to fully leverage the flexibility and scalability of QUAlibrate.</p>
<h2 id="initial-script">Initial Script</h2>
<p>As a basic example, let us assume we already have a calibration script. Such a script typically runs a program on quantum control hardware. For this example, we will use a simplified script that emulates data for demonstration purposes, rather than an actual quantum control script:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="c1"># Define input parameters</span>
<span class="n">span</span> <span class="o">=</span> <span class="mf">20e3</span>
<span class="n">num_points</span> <span class="o">=</span> <span class="mi">101</span>

<span class="c1"># Generate data</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="n">span</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">span</span> <span class="o">/</span> <span class="mi">20</span>
<span class="n">noise_factor</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">sweep_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">sweep_values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">noise_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">+</span> <span class="n">noise</span>

<span class="c1"># Analyse results</span>
<span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">peak_coord</span> <span class="o">=</span> <span class="n">sweep_values</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>
<span class="n">peak_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>

<span class="c1"># Plot results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweep_values</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_coord</span><span class="p">,</span> <span class="n">peak_val</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</code></pre></div>
<p>The emulated data consists of a peak with noise superimposed, and the script extracts the peak. The resulting figure should look something like the following<br />
<img alt="Simulated Output" src="../assets/simulated_data_output.png" /></p>
<h2 id="conversion-into-a-qualibrationnode">Conversion into a <code>QualibrationNode</code></h2>
<p>We now make adjustments to the previous script to transform the code into a QualibrationNode. We first present the individual modifications, and then present the fully converted node.</p>
<h3 id="importing-qualibrate">Importing <code>qualibrate</code></h3>
<p>The first step is to import the relevant classes from <code>qualibrate</code>. We need <code>NodeParameters</code> to encapsulate the parameters and <code>QualibrationNode</code> to create the node:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">qualibrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">NodeParameters</span><span class="p">,</span> <span class="n">QualibrationNode</span>
</code></pre></div>
<h3 id="defining-input-parameters">Defining Input Parameters</h3>
<p>Instead of defining parameters as standalone variables, we group them together in a <code>NodeParameters</code> subclass:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Parameters</span><span class="p">(</span><span class="n">NodeParameters</span><span class="p">):</span>
    <span class="n">span</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20e3</span>
    <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">101</span>
</code></pre></div>
<p>Using <code>NodeParameters</code> allows parameters to be modified externally, such as through the QUAlibrate web interface. For example, this makes it easy to adapt calibration settings for different hardware configurations without changing the code.</p>
<h3 id="creating-the-qualibrationnode">Creating the <code>QualibrationNode</code></h3>
<p>Next, we instantiate the <code>QualibrationNode</code> with a unique name (<code>"emulated_calibration"</code>) and provide an instance of the <code>Parameters</code> class:</p>
<div class="highlight"><pre><span></span><code><span class="n">node</span> <span class="o">=</span> <span class="n">QualibrationNode</span><span class="p">(</span><span class="s2">&quot;emulated_calibration&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">Parameters</span><span class="p">())</span>
</code></pre></div>
<p>This will enable the <code>QualibrationLibrary</code> to run this calibration node externally, provided that the script is located in the <code>calibration_library_folder</code> of the <a href="../configuration/">configuration file</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Avoid significant code before this point</p>
<p>The <code>QualibrationLibrary</code> executes each calibration node script sequentially until a <code>QualibrationNode</code> is instantiated.
This approach optimizes efficiency by stopping further execution once the node is created, preventing unnecessary code execution and saving system resources.
Avoid placing time-consuming operations, such as hardware initialization, before this point to ensure efficient scanning by the library.</p>
</div>
<h3 id="using-node-parameters-in-the-script">Using Node Parameters in the Script</h3>
<p>The original script can now be adapted to use parameters from the <code>NodeParameters</code> instance:</p>
<div class="highlight"><pre><span></span><code><span class="n">sweep_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
</code></pre></div>
<p>This ensures that parameters can be easily adjusted when the node is called externally.</p>
<h3 id="registering-results">Registering Results</h3>
<p>Once the data has been retrieved and analysed, we register the results with the node to ensure they are saved after execution:</p>
<div class="highlight"><pre><span></span><code><span class="n">node</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span>
    <span class="s2">&quot;arrays&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sweep_values&quot;</span><span class="p">:</span> <span class="n">sweep_values</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">},</span>
    <span class="s2">&quot;peak_coord&quot;</span><span class="p">:</span> <span class="n">peak_coord</span><span class="p">,</span>
    <span class="s2">&quot;peak_val&quot;</span><span class="p">:</span> <span class="n">peak_val</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
<p>A variety of results can be stored, including</p>
<ul>
<li>Standard types: <code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, etc.</li>
<li>Nested lists and dictionaries</li>
<li><a href="https://numpy.org/">Numpy</a> arrays</li>
<li><a href="https://github.com/pydata/xarray">Xarray</a> datasets</li>
<li><a href="https://matplotlib.org/">Matplotlib</a> figures</li>
</ul>
<p>Additional result types can be supported via plugins.</p>
<h3 id="saving-results">Saving Results</h3>
<p>Finally, the registered results are saved using the following command:</p>
<div class="highlight"><pre><span></span><code><span class="n">node</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<p>This saves the results in the location specified by <code>qualibrate.storage.location</code> in the <a href="../configuration/">configuration file</a>.</p>
<h2 id="fully-converted-node">Fully Converted Node</h2>
<p>After following all the steps, the fully converted node looks as follows:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qualibrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">NodeParameters</span><span class="p">,</span> <span class="n">QualibrationNode</span>

<span class="c1"># Define input parameters for QualibrationNode</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Parameters</span><span class="p">(</span><span class="n">NodeParameters</span><span class="p">):</span>
    <span class="n">span</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20e3</span>
    <span class="n">num_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">101</span>

<span class="c1"># Create QualibrationNode</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">QualibrationNode</span><span class="p">(</span><span class="s2">&quot;emulated_calibration&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">Parameters</span><span class="p">())</span>

<span class="c1"># Generate data using node parameters</span>
<span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">5</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">20</span>
<span class="n">noise_factor</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">sweep_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="o">-</span><span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">num_points</span>
<span class="p">)</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">sweep_values</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">noise_factor</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">gaussian</span> <span class="o">+</span> <span class="n">noise</span>

<span class="c1"># Analyse results</span>
<span class="n">peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">peak_coord</span> <span class="o">=</span> <span class="n">sweep_values</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>
<span class="n">peak_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">peak_idx</span><span class="p">]</span>

<span class="c1"># Plot results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sweep_values</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">peak_coord</span><span class="p">,</span> <span class="n">peak_val</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># Register results</span>
<span class="n">node</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span>
    <span class="s2">&quot;arrays&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sweep_values&quot;</span><span class="p">:</span> <span class="n">sweep_values</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">},</span>
    <span class="s2">&quot;peak_coord&quot;</span><span class="p">:</span> <span class="n">peak_coord</span><span class="p">,</span>
    <span class="s2">&quot;peak_val&quot;</span><span class="p">:</span> <span class="n">peak_val</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Save results</span>
<span class="n">node</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</code></pre></div>
<p>This node can still be executed directly from any code editor and shouldn't cause any different behaviour.
The advantage is that it can now also be called externally, for example as part of a calibration graph, or through the <a href="../web_app/">QUAlibrate Web App</a>.</p>
<h2 id="combining-quam-with-qualibrate">Combining QUAM with QUAlibrate</h2>
<p>QUAM (Quantum Abstract Machine) abstracts the QUA programming language, letting researchers focus on qubits and quantum operations instead of hardware. Integrated with QUAlibrate, QUAM streamlines calibration, enabling smooth transitions between quantum programming and system calibration.</p>
<p>QUAM serves as a persistent digital model of the quantum setup. Calibration nodes update specific entries in QUAM, creating an evolving system model. Each calibration node loads the latest version of QUAM, ensuring consistency and efficiency throughout the calibration process.</p>
<p>For details on QUAM please visit <a href="http://qua-platform.github.io/quam/">http://qua-platform.github.io/quam/</a>.</p>
<p>To incorporate QUAM into the <code>QualibrationNode</code>, we assume QUAM can be loaded using a method like <code>QuAM.load()</code>. It can then be added to the node as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">node</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="n">QuAM</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</code></pre></div>
<p>This step automatically includes a snapshot of QUAM when saving the node using <code>node.save()</code>.</p>
<p>Additionally, if <code>quam.state_path</code> is set in the <a href="../configuration/">configuration file</a>, it will be updated when saving the node.</p>
<p>Finally, the <code>QualibrationNode</code> also provides a way to record any changes to QUAM interactively by encapsulating these state updates as follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="n">node</span><span class="o">.</span><span class="n">record_state_updates</span><span class="p">():</span>
    <span class="c1"># Modify the resonance frequency of a qubit</span>
    <span class="n">machine</span><span class="o">.</span><span class="n">qubits</span><span class="p">[</span><span class="s2">&quot;q0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">f_01</span> <span class="o">=</span> <span class="mf">5.1e9</span>
</code></pre></div>
<p>This will simply update the values if the script is executed normally. However, if the node is executed through the <a href="../web_app/">QUAlibrate Web App</a>, any changes will be presented as a proposed state update to the user, allowing them to interactively accept or decline the changes based on the measurement outcomes.</p>
<p>Note that this action should be performed before calling <code>node.save()</code>.</p>
<h2 id="structuring-nodes-with-actions-optional">Structuring Nodes with Actions (Optional)</h2>
<p>While the examples above show the entire logic within a single script, you can optionally structure your <code>QualibrationNode</code> code using <strong>Node Actions</strong>. This approach involves breaking down the node's logic into distinct functions marked with the <code>@node.run_action</code> decorator.</p>
<p>Using Node Actions offers several advantages:</p>
<ul>
<li><strong>Improved Readability &amp; Maintainability:</strong> Encapsulating logic (e.g., data generation, analysis, saving) into named functions makes the script easier to understand and modify.</li>
<li><strong>Clearer Execution Flow:</strong> Conditional execution (<code>skip_if</code>) can be handled cleanly within the decorator, avoiding complex <code>if/else</code> blocks in the main script body.</li>
<li><strong>Enhanced Modularity:</strong> Actions function as largely independent units, sharing data explicitly via <code>node.namespace</code>. This reduces coupling between different parts of the script.</li>
<li><strong>Interactivity:</strong> Actions can often be recognized as runnable cells in editors like VS Code, simplifying debugging and interactive execution of specific steps.</li>
<li><strong>Web App Integration:</strong> The <a href="../web_app/">QUAlibrate Web App</a> displays the currently running Node Action, providing better visibility into the execution progress of your calibration script.</li>
</ul>
<p>For a detailed explanation and examples of how to use Node Actions, including data sharing and conditional execution, please refer to the <a href="../node_actions/">Node Actions</a> page.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Q.M Technologies Ltd.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotations", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>